@page "/Favorites"
@using HttpClients.Interfaces
@using BlazorApp.Service
@using HttpClients.Implementations
@inject IItemService ItemService
@inject NavService NavService
<h3>Favorites</h3>
<AuthorizeView>
    <Authorized>
        @if (items == null || !items.Any())
        {
            <MudText>You currently do not have any favorites.</MudText>
        }
        else
        {
            @foreach (var item in items)
            {
                <MudPaper>
                    <FavoriteCard Title="@item.Title" Description="@item.Description" Price="@item.Price"></FavoriteCard>
                </MudPaper>
            }
        }
    </Authorized>
    <NotAuthorized>
        <MudText>Please <MudLink Href="/Login">log in</MudLink> to view favorites.</MudText>
    </NotAuthorized>
</AuthorizeView>

@code {
    private IEnumerable<Item>? items { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        await LoadItems();
    }

    private async Task LoadItems()
    {
        items = await ItemService.GetFavItemsByUserId(NavService.LoggedInUserId, UserHttpClient.Jwt);
        StateHasChanged(); //re-render if there are any changes
    }
}